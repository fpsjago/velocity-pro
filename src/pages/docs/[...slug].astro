---
import { getCollection, render } from 'astro:content';
import DocsLayout from '../../layouts/DocsLayout.astro';
import DocsSidebar from '../../components/Docs/DocsSidebar';

export async function getStaticPaths() {
  const docs = await getCollection('docs');
  return docs.map(doc => ({
    params: { slug: doc.id },
    props: { doc },
  }));
}

const { doc } = Astro.props;
const { Content } = await render(doc);

const allDocs = await getCollection('docs');
const sidebarDocs = allDocs
  .map(d => ({ title: d.data.title, slug: d.id, section: d.data.section, order: d.data.order }))
  .sort((a, b) => a.order - b.order);
---
<DocsLayout title={doc.data.title} description={doc.data.description}>
  <div class="docs-page">
    <aside class="docs-aside">
      <DocsSidebar client:load docs={sidebarDocs} currentSlug={doc.id} />
    </aside>
    <main class="docs-content prose">
      <h1>{doc.data.title}</h1>
      <Content />
    </main>
  </div>
</DocsLayout>

<style>
  .docs-page {
    display: grid;
    grid-template-columns: 280px 1fr;
    min-height: calc(100vh - var(--header-height, 72px));
    max-width: 1200px;
    margin: 0 auto;
  }
  .docs-aside {
    padding: 2rem 1rem;
    border-right: 1px solid var(--border);
    position: sticky;
    top: 0;
    height: 100vh;
    overflow-y: auto;
  }
  .docs-content {
    padding: 2rem 3rem;
    max-width: 800px;
  }
  @media (max-width: 768px) {
    .docs-page { grid-template-columns: 1fr; }
    .docs-aside { display: none; }
    .docs-content { padding: 1.5rem; }
  }
</style>
